<!DOCTYPE html>
<html lang="ru"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Developer articles | Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="Developer articles" />
<meta property="og:locale" content="ru" />
<meta name="description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description." />
<meta property="og:description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description." />
<link rel="canonical" href="https://st4lk.github.io/" />
<meta property="og:url" content="https://st4lk.github.io/" />
<meta property="og:site_name" content="Developer articles" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Developer articles" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebSite","description":"Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.","headline":"Developer articles","name":"Developer articles","url":"https://st4lk.github.io/"}</script>
<!-- End Jekyll SEO tag -->
<link rel="shortcut icon" type="image/png" href="/favicon.png">
  <link rel="stylesheet" href="/assets/main.css">
  <link rel="stylesheet" href="/assets/css/styles.css"><link type="application/atom+xml" rel="alternate" href="https://st4lk.github.io/feed.xml" title="Developer articles" /><script async defer src="https://buttons.github.io/buttons.js"></script>
</head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Записи разработчика</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">Контакты</a><a class="page-link" style="margin-right: 0px" href="/" ><img src="/assets/images/ru.png" /></a>
          <a class="page-link" href="/en/" ><img src="/assets/images/en.png" /></a>
        </div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <div class="home">
<h2 class="post-list-heading">Posts</h2>
    <ul class="post-list"><li><span class="post-meta">Apr 17, 2015</span>
        <h3>
          <a class="post-link" href="/fun/security/2015/04/17/listen-wifi-with-wireshark.html">
            Слушаем wifi с помощью wireshark
          </a>
        </h3><p><a href="/fun/security/2015/04/17/listen-wifi-with-wireshark.html"><img src="https://img-fotki.yandex.ru/get/16098/85893628.c68/0_17f35c_4bf9a7fe_M.jpg" alt="Слушаем wifi с помощью wireshark" title="Слушаем wifi с помощью wireshark" /></a></p>

<p>Всегда знал, что можно посмотреть сетевые пакеты, которые передаются по wifi сети. Но на практике этого не делал (на работе анализировал сетевые пакеты, но то был не HTTP протокол). Решил восполнить этот пробел, ведь это интересно и полезно. Более стройно выстраивается понимание протоколов TCP-IP и HTTP. Видно, как летят наши пароли и сессии, после такого опыта поневоле начинаешь относиться к безопасности сайта с большим трепетом.</p>

</li><li><span class="post-meta">Mar 4, 2015</span>
        <h3>
          <a class="post-link" href="/database/django/logging/sql/2015/03/04/debug-sql-django-test.html">
            Отладка SQL в django тестах
          </a>
        </h3><p><a href="/database/django/logging/sql/2015/03/04/debug-sql-django-test.html"><img src="https://img-fotki.yandex.ru/get/4517/85893628.c67/0_1795f5_a958c090_orig.png" alt="Отладка SQL в django тестах" title="Отладка SQL в django тестах" /></a></p>

<p>В django тестах можно замерять количество сделанных SQL запросов:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">test_home</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">with</span> <span class="bp">self</span><span class="p">.</span><span class="n">assertNumQueries</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">client</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'/'</span><span class="p">)</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</code></pre></div></div>

<p>Если код в контексте <code class="language-plaintext highlighter-rouge">assertNumQueries</code> сделает иное количество обращений к БД, чем ожидается (здесь 1), то тест выдает ошибку. Но когда такой тест не проходит, бывает трудно определить лишний отправленный запрос. Для отладки такого случая удобно вывести в консоль отправленные SQL запросы. Далее опишу, как этого добиться.</p>

<p>Кстати, если вы используете Django 1.7+, то вместе с ошибкой будут показаны все SQL выражения, т.е. если этого достаточно - то делать вообще ничего не надо. Ура! Если же вы используете более старые версии, то данная статья будет полезна.</p>

<h3 id="настройка-логов-для-вывода-sql-запросов-в-консоль">Настройка логов для вывода SQL запросов в консоль</h3>

<p>Django будет логировать SQL запрос, если соблюдается одного из следующих условий:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">settings</span><span class="p">.</span><span class="n">DEBUG</span> <span class="o">=</span> <span class="bp">True</span>
</code></pre></div></div>

<p>или</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">connection</span><span class="p">.</span><span class="n">use_debug_cursor</span> <span class="o">=</span> <span class="bp">True</span>
</code></pre></div></div>

<p>По умолчанию в тестах всегда <em>DEBUG = False</em> вне зависимости от того, что стоит в вашем <em>settings.DEBUG</em>. Это правильно, тестировать лучше с боевыми настройками.</p>

<p>Т.о. остается <em>connection.use_debug_cursor</em>, которое по умолчанию всегда <em>None</em> или <em>False</em> (в разных версиях по разному). Но контекстный менеджер <em>assertNumQueries</em> сам выставляет это значение в <em>True</em> на время работы соответствующего блока! Нам остается лишь правильно задать настройки логов.</p>

<p>Создадим отдельный файл настроек для тестов и назовем его settings_test.py. Тесты гонять будем с ним. Рекомендую всегда делать так - это удобно. Структура проекта примерно такая:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>project
├── project
│   ├── __init__.py
│   ├── settings.py
│   ├── settings_test.py
│   ├── urls.py
│   └── wsgi.py
│
├── spam  <span class="c"># some app</span>
│   ├── __init__.py
│   ├── views.py
│   ├── tests.py
│   └── models.py
│
└── manage.py
</code></pre></div></div>

<p>Файл tests.py содержит тесты приложения spam. Так организовывать тесты не самый хороший выбор, лучше выделить отдельную папку и держать все тесты там. Но для простоты нашего примера годится.</p>

<p>Содержимое settings_test.py:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">settings</span> <span class="kn">import</span> <span class="o">*</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">settings</span> <span class="kn">import</span> <span class="n">LOGGING</span>
<span class="k">except</span> <span class="nb">ImportError</span><span class="p">:</span>
    <span class="n">LOGGING</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">version</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">disable_existing_loggers</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
        <span class="n">handlers</span><span class="o">=</span><span class="p">{},</span> <span class="n">loggers</span><span class="o">=</span><span class="p">{})</span>

<span class="c1"># use database in memory to not lose your data!
</span><span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'default'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">'ENGINE'</span><span class="p">:</span> <span class="s">'django.db.backends.sqlite3'</span><span class="p">,</span>
        <span class="s">'NAME'</span><span class="p">:</span> <span class="s">':memory:'</span><span class="p">,</span>
        <span class="s">'USER'</span><span class="p">:</span> <span class="s">''</span><span class="p">,</span>
        <span class="s">'PASSWORD'</span><span class="p">:</span> <span class="s">''</span><span class="p">,</span>
        <span class="s">'TEST_CHARSET'</span><span class="p">:</span> <span class="s">'utf8'</span><span class="p">,</span>
    <span class="p">}}</span>

<span class="n">LOGGING</span><span class="p">[</span><span class="s">'handlers'</span><span class="p">][</span><span class="s">'console'</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'level'</span><span class="p">:</span> <span class="s">'DEBUG'</span><span class="p">,</span>
    <span class="s">'class'</span><span class="p">:</span> <span class="s">'logging.StreamHandler'</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">LOGGING</span><span class="p">[</span><span class="s">'loggers'</span><span class="p">][</span><span class="s">'django.db.backends'</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'handlers'</span><span class="p">:</span> <span class="p">[</span><span class="s">'console'</span><span class="p">],</span>
    <span class="s">'level'</span><span class="p">:</span> <span class="s">'DEBUG'</span><span class="p">,</span>
    <span class="s">'propagate'</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">LOGGING</span><span class="p">[</span><span class="s">'loggers'</span><span class="p">][</span><span class="s">'django.db.backends.schema'</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'propagate'</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>  <span class="c1"># don't log schema queries, django &gt;= 1.7
</span><span class="p">}</span>
</code></pre></div></div>

<p>Тест (tests.py) выглядит так:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>
<span class="kn">from</span> <span class="nn">spam.models</span> <span class="kn">import</span> <span class="n">Foo</span>

<span class="k">class</span> <span class="nc">SpamTestCase</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Foo</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Foo"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_home</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="p">.</span><span class="n">assertNumQueries</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">client</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'/'</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</code></pre></div></div>

<p>Давайте посмотрим, что будет при прогоне теста используя разные runner’ы.</p>

<h4 id="django-14">Django 1.4+</h4>

<p><code class="language-plaintext highlighter-rouge">$ python manage.py test</code> (нет SQL):</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Creating <span class="nb">test </span>database <span class="k">for </span><span class="nb">alias</span> <span class="s1">'default'</span>...
<span class="nb">.</span>
<span class="nt">----------------------------------------------------------------------</span>
Ran 1 <span class="nb">test </span><span class="k">in </span>0.009s

OK
Destroying <span class="nb">test </span>database <span class="k">for </span><span class="nb">alias</span> <span class="s1">'default'</span>...
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">$ python manage.py test  --settings=project.settings_test</code> (SQL в консоле)</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Creating <span class="nb">test </span>database <span class="k">for </span><span class="nb">alias</span> <span class="s1">'default'</span>...
<span class="o">(</span>0.000<span class="o">)</span> SELECT <span class="s2">"spam_foo"</span>.<span class="s2">"id"</span>, <span class="s2">"spam_foo"</span>.<span class="s2">"title"</span> FROM <span class="s2">"spam_foo"</span> LIMIT 21<span class="p">;</span> <span class="nv">args</span><span class="o">=()</span>
<span class="nb">.</span>
<span class="nt">----------------------------------------------------------------------</span>
Ran 1 <span class="nb">test </span><span class="k">in </span>0.009s

OK
Destroying <span class="nb">test </span>database <span class="k">for </span><span class="nb">alias</span> <span class="s1">'default'</span>...
</code></pre></div></div>

<h4 id="django-14-и-django-nose">Django 1.4+ и django-nose</h4>

<ul>
  <li>pip install django-nose</li>
  <li>в settings.py выставляем <em>TEST_RUNNER = ‘django_nose.NoseTestSuiteRunner’</em></li>
</ul>

<p><code class="language-plaintext highlighter-rouge">$ python manage.py test</code> (нет SQL):</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">$ python manage.py test  --settings=project.settings_test</code> (SQL в консоле)</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span>0.000<span class="o">)</span> SELECT <span class="s2">"spam_foo"</span>.<span class="s2">"id"</span>, <span class="s2">"spam_foo"</span>.<span class="s2">"title"</span> FROM <span class="s2">"spam_foo"</span> LIMIT 21<span class="p">;</span> <span class="nv">args</span><span class="o">=()</span>
...
</code></pre></div></div>

<h4 id="django-14-и-pytest-django">Django 1.4+ и pytest-django</h4>

<ul>
  <li>pip install pytest-django</li>
  <li>создаем файл pytest.ini рядом с manage.py и задаем файл настроек:</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="o">[</span>pytest]
    DJANGO_SETTINGS_MODULE <span class="o">=</span> project.settings
</code></pre></div></div>

<ul>
  <li>переименуем tests.py в test_spam.py (стандартные имена для py.test)</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">$ py.test</code> (нет SQL):</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">$ py.test  --ds=project.settings_test</code> (нет SQL, py.test перехватывает весь вывод)</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">$ py.test  --ds=project.settings_test -s</code> (SQL в консоле)</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">000</span><span class="p">)</span> <span class="k">SELECT</span> <span class="nv">"spam_foo"</span><span class="p">.</span><span class="nv">"id"</span><span class="p">,</span> <span class="nv">"spam_foo"</span><span class="p">.</span><span class="nv">"title"</span> <span class="k">FROM</span> <span class="nv">"spam_foo"</span> <span class="k">LIMIT</span> <span class="mi">21</span><span class="p">;</span> <span class="n">args</span><span class="o">=</span><span class="p">()</span>
<span class="p">...</span>
</code></pre></div></div>

<h4 id="итого">Итого</h4>

<p>Как видно из предыдущих примеров, при использовании нашего settings_test в консоль выводятся все запросы к БД, сделанные в блоке контекстного менеджера <em>assertNumQueries</em>.</p>

<p>Если мы хотим гонять тесты всегда с этими настройками, а не только когда хотим что-то отладить, то очень скоро устанем от обилия SQL. Можно сделать так: закомментировать строчку <code class="language-plaintext highlighter-rouge">'handlers': ['console'],</code>, т.о. ничего выводится не будет. А когда нужно их посмотреть - просто убираем комментарий.</p>

<h3 id="вывод-ошибки-assertnumqueries-и-django-17">Вывод ошибки assertNumQueries и Django 1.7+</h3>

<p>Если <em>assertNumQueries</em> регистрирует отличное от ожидаемого количество обращений к БД, то выводится traceback и ошибка:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="p">...</span>
<span class="nb">AssertionError</span><span class="p">:</span> <span class="mi">1</span> <span class="n">queries</span> <span class="n">executed</span><span class="p">,</span> <span class="mi">2</span> <span class="n">expected</span>
</code></pre></div></div>

<p>Но в django 1.7+ так же выводятся и сделанные запросы:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Captured</span> <span class="n">queries</span> <span class="n">were</span><span class="p">:</span>
<span class="n">QUERY</span> <span class="o">=</span> <span class="n">u</span><span class="s1">'SELECT "spam_foo"."id", "spam_foo"."title" FROM "spam_foo" LIMIT 21'</span> <span class="o">-</span> <span class="n">PARAMS</span> <span class="o">=</span> <span class="p">()</span>
</code></pre></div></div>

<p>Как вы понимаете, настройки логов на это не влияют, очень удобно!</p>

<h3 id="вывод-всех-sql-запросов-в-консоль-не-используя-assertnumqueries">Вывод всех SQL запросов в консоль не используя assertNumQueries</h3>

<p>До сих пор речь шла об использовании <em>assertNumQueries</em>. Но что если нужно посмотреть запросы вне этого менеджера?</p>

<p>Для этого нужно самому выставить <code class="language-plaintext highlighter-rouge">connection.use_debug_cursor = True</code> перед прогоном тестов. Это можно сделать в test runner’е или используя специальный hook в py.test.</p>

<h4 id="sql-во-всех-тестах-django-14">SQL во всех тестах: Django 1.4+</h4>

<p>Создаем файл test_runner.py, кладем его рядом с settings.py и вставляем такой код:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">django.test.runner</span> <span class="kn">import</span> <span class="n">DiscoverRunner</span> <span class="k">as</span> <span class="n">DjangoTestSuiteRunner</span>
<span class="k">except</span> <span class="nb">ImportError</span><span class="p">:</span>
    <span class="c1"># django &lt; 1.6
</span>    <span class="kn">from</span> <span class="nn">django.test.simple</span> <span class="kn">import</span> <span class="n">DjangoTestSuiteRunner</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">connections</span><span class="p">,</span> <span class="n">DEFAULT_DB_ALIAS</span>

<span class="k">class</span> <span class="nc">SqlDebugTestSuiteRunner</span><span class="p">(</span><span class="n">DjangoTestSuiteRunner</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setup_test_environment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SqlDebugTestSuiteRunner</span><span class="p">,</span> <span class="bp">self</span><span class="p">).</span><span class="n">setup_test_environment</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">connections</span><span class="p">[</span><span class="n">DEFAULT_DB_ALIAS</span><span class="p">].</span><span class="n">use_debug_cursor</span> <span class="o">=</span> <span class="bp">True</span>
</code></pre></div></div>

<p>Теперь либо в settings (или settings_test, если используем его для тестов) указываем наш runner:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">TEST_RUNNER</span> <span class="o">=</span> <span class="s">'project.test_runner.SqlDebugTestSuiteRunner'</span>
</code></pre></div></div>

<p>Запускаем <code class="language-plaintext highlighter-rouge">python manage.py test --settings=project.settings_test</code> и видим все запросы, созданные за время тестов.</p>

<p>Либо можно не задавать <em>TEST_RUNNER</em>, а использовать аргумент <em>–testrunner</em>:</p>

<p><code class="language-plaintext highlighter-rouge">python manage.py test --settings=project.settings_test --testrunner=project.test_runner.SqlDebugTestSuiteRunner</code></p>

<p>Результат будет тем же.</p>

<h4 id="sql-во-всех-тестах-django-14-и-django-nose">SQL во всех тестах: Django 1.4+ и django-nose</h4>

<p>Для nose почти все так же, только runner нужно унаследовать от NoseTestSuiteRunner.</p>

<p>test_runner.py:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">django_nose</span> <span class="kn">import</span> <span class="n">NoseTestSuiteRunner</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">connections</span><span class="p">,</span> <span class="n">DEFAULT_DB_ALIAS</span>

<span class="k">class</span> <span class="nc">SqlDebugTestSuiteRunner</span><span class="p">(</span><span class="n">NoseTestSuiteRunner</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setup_test_environment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SqlDebugTestSuiteRunner</span><span class="p">,</span> <span class="bp">self</span><span class="p">).</span><span class="n">setup_test_environment</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">connections</span><span class="p">[</span><span class="n">DEFAULT_DB_ALIAS</span><span class="p">].</span><span class="n">use_debug_cursor</span> <span class="o">=</span> <span class="bp">True</span>
</code></pre></div></div>

<p>Да, на момент написания статьи версия django-nose==1.3. В этой версии не поддерживается аргумент <em>–testrunner</em>. Но я отправил <a href="https://github.com/django-nose/django-nose/pull/187">пул реквест</a>, возможно, он уже попал в релиз.</p>

<h4 id="sql-во-всех-тестах-django-14-и-pytest-django">SQL во всех тестах: Django 1.4+ и pytest-django</h4>

<p>В py.test все немного по другому, ведь там не используется стандартный runner из django. Вместо этого для установления тестового окружения можно использовать py.test хуки.</p>

<p>Создаем файл plugin_debug_sql.py, кладем рядом с settings.py, вставляем код:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">pytest_runtest_setup</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">connections</span><span class="p">,</span> <span class="n">DEFAULT_DB_ALIAS</span>
    <span class="n">connections</span><span class="p">[</span><span class="n">DEFAULT_DB_ALIAS</span><span class="p">].</span><span class="n">use_debug_cursor</span> <span class="o">=</span> <span class="bp">True</span>
</code></pre></div></div>

<p>Запускать так:</p>

<p><code class="language-plaintext highlighter-rouge">PYTHONPATH=`pwd`:$PYTHONPATH py.test -s --ds=sql.settings_test -p project.plugin_debug_sql</code></p>

<p>Тут я явно добавляю текущую папку в PYTHONPATH, потому что иначе py.test не сможет найти наш плагин.</p>
</li><li><span class="post-meta">Jan 31, 2015</span>
        <h3>
          <a class="post-link" href="/i18n/async/tornado/2015/01/31/tornado-internationalization-and-localization.html">
            Tornado i18n и l10n
          </a>
        </h3><p><a class="github-button" href="https://github.com/st4lk/tornado_i18n_example" data-color-scheme="no-preference: light; light: light; dark: dark;" data-icon="octicon-star" data-size="large" data-show-count="true" aria-label="Star st4lk/tornado_i18n_example on GitHub">Star</a></p>

<p><a href="/i18n/async/tornado/2015/01/31/tornado-internationalization-and-localization.html"><img src="https://img-fotki.yandex.ru/get/4/85893628.c67/0_1715c7_738478c6_orig.png" alt="Tornado i18n и l10n" title="Tornado i18n и l10n" /></a></p>

<p>Статья о том, что такое i18n и i10n и как это реализовать в приложении на <a href="http://www.tornadoweb.org/en/stable/">tornado</a>. Получилось довольно много букв, но хотелось рассказать доступно обо всем процессе. Сама пошаговая инструкция - во второй половине статьи.</p>

</li><li><span class="post-meta">Jan 18, 2015</span>
        <h3>
          <a class="post-link" href="/database/mongodb/2015/01/18/timestamp-objectid-mongodb.html">
            Timestamp и ObjectId в mongoDB
          </a>
        </h3><p><a href="/database/mongodb/2015/01/18/timestamp-objectid-mongodb.html"><img src="https://img-fotki.yandex.ru/get/17859/85893628.c67/0_16f717_c4a5da7b_orig.png" alt="Timestamp и ObjectId в mongoDB" title="Timestamp и ObjectId в mongoDB" /></a></p>

<p>У каждой записи в mongoDB есть поле <code class="language-plaintext highlighter-rouge">_id</code>, которое должно быть уникальным в коллекции.
По умолчанию тип этого поля - <a href="http://docs.mongodb.org/manual/reference/object-id/">ObjectId</a>, и оно присваивается автоматически, если поле не заполнено при сохранении.</p>

<p>Давайте рассмотрим, что из себя представляет тип ObjectId.</p>

</li><li><span class="post-meta">Dec 15, 2014</span>
        <h3>
          <a class="post-link" href="/tornado/2014/12/15/set-url-for-tornado-handlers.html">
            Задание url для обработчиков Tornado
          </a>
        </h3><p><a href="/tornado/2014/12/15/set-url-for-tornado-handlers.html"><img src="https://img-fotki.yandex.ru/get/17846/85893628.c66/0_1644bf_5c58d342_L.png" alt="Задание url для обработчиков Tornado" title="Задание url для обработчиков Tornado" /></a></p>

<p>В tornado, для привязки обработчиков к url’ам, можно передать список из кортежей <code class="language-plaintext highlighter-rouge">(url regex, handler)</code> при инициализации приложения:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">application</span> <span class="o">=</span> <span class="n">tornado</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">Application</span><span class="p">([</span>
    <span class="p">(</span><span class="sa">r</span><span class="s">"/"</span><span class="p">,</span> <span class="n">MainHandler</span><span class="p">),</span>
    <span class="p">(</span><span class="sa">r</span><span class="s">"/some/path/page/(?P&lt;pk&gt;[0-9]+)$"</span><span class="p">,</span> <span class="n">PageHandler</span><span class="p">),</span>
<span class="p">])</span>
</code></pre></div></div>

<p>Но не секрет, что гораздо удобнее использовать обертку <a href="http://www.tornadoweb.org/en/stable/web.html?highlight=url#tornado.web.URLSpec"><code class="language-plaintext highlighter-rouge">tornado.web.url</code></a>, которая позволяет присваивать имена для путей (похожа на <a href="https://docs.djangoproject.com/en/dev/ref/urls/#django.conf.urls.url">django’вский url</a>).</p>

</li><li><span class="post-meta">Nov 2, 2014</span>
        <h3>
          <a class="post-link" href="/django/celery/2014/11/02/django-celery-setup.html">
            Подключение celery к django
          </a>
        </h3><p><a href="/django/celery/2014/11/02/django-celery-setup.html"><img src="/assets/images/posts/2014-11-02-django-celery-setup/2and5_celery_420.jpeg" alt="Подключение celery к django" title="Подключение celery к django" /></a></p>

<p>Для подключения <a href="http://www.celeryproject.org/">celery</a> к новому проекту так или иначе приходится подглядывать в предыдущие, чтобы вспомнить необходимые шаги: какие настройки задавать, как запускать, как останавливать и т.д.</p>

<p>Хочу собрать все в одном месте.</p>

</li><li><span class="post-meta">Sep 9, 2014</span>
        <h3>
          <a class="post-link" href="/database/django/sql/2014/09/09/nested-sql-queries-django.html">
            Вложенные SQL запросы в Django
          </a>
        </h3><p><a href="/database/django/sql/2014/09/09/nested-sql-queries-django.html"><img src="/assets/images/posts/2014-09-09-nested-sql-queries-django/Kenguru-origami-za-shemoj-Stephen-Weiss.jpeg" alt="Вложенные SQL запросы в Django" title="Вложенные SQL запросы в Django" /></a></p>

<p>Вы знали, что Django ORM умеет делать <a href="https://docs.djangoproject.com/en/dev/ref/models/querysets/#in">вложенные SQL запросы</a>? К своему стыду я узнал это не так давно.</p>

</li><li><span class="post-meta">May 29, 2014</span>
        <h3>
          <a class="post-link" href="/fun/free/2014/05/29/new-relic-free-shirt.html">
            Бесплатная футболка от New Relic
          </a>
        </h3><p><a href="/fun/free/2014/05/29/new-relic-free-shirt.html"><img src="/assets/images/posts/2014-05-29-new-relic-free-shirt/tshift_orig.png" alt="Бесплатная футболка от New Relic" title="Бесплатная футболка от New Relic" /></a></p>

<p><a href="http://newrelic.com/">New Relic</a> - сервис для мониторинга веб приложения. Позволяет в подробных деталях смотреть статистику работы, где программа тратит больше всего времени, как часто обращается к базе данных и много всего прочего. Для описания этого прекрасного сервиса следует уделить отдельный пост. Здесь же хочу рассказать о другом - как я получил бесплатную футболку от New Relic.</p>

<p>На самом деле, для этого нужно лишь зарегистрироваться и настроить New Relic на работающем сайте. Как и сказано в их <a href="http://newrelic.com/lp/datanerd">предложении</a>.</p>

</li><li><span class="post-meta">May 9, 2014</span>
        <h3>
          <a class="post-link" href="/deploy/free/2014/05/09/remote-url-localhost-server.html">
            Внешний url для localhost сервера
          </a>
        </h3><p><a href="/deploy/free/2014/05/09/remote-url-localhost-server.html"><img src="/assets/images/posts/2014-05-09-remote-url-localhost-server/ngrok_logo.jpeg" alt="Внешний url для localhost сервера" title="Внешний url для localhost сервера" /></a></p>

<p>Есть замечательная тулза под названием <a href="https://ngrok.com/">ngrok</a>. Она позволяет привязать URL для вашего localhost сервера!</p>

</li><li><span class="post-meta">Mar 14, 2014</span>
        <h3>
          <a class="post-link" href="/api/django/email/free/2014/03/14/send-email-django-project-mandrill-service.html">
            Отправка писем в django проекте с помощью сервиса mandrill
          </a>
        </h3><p><a href="/api/django/email/free/2014/03/14/send-email-django-project-mandrill-service.html"><img src="/assets/images/posts/2014-03-14-send-email-django-project-mandrill-service/mandrill-email.png" alt="Отправка писем в django проекте с помощью сервиса mandrill" title="Отправка писем в django проекте с помощью сервиса mandrill" /></a></p>

<p>Отправлять email сообщения с сервера можно просто по SMTP протоколу. Но есть другой способ - через специальные сервисы рассылки. Про один такой, <a href="http://mandrill.com/">mandrill.com</a>, я немного расскажу.</p>

</li><li><span class="post-meta">Mar 7, 2014</span>
        <h3>
          <a class="post-link" href="/database/mongodb/2014/03/07/mongodb-indexes.html">
            Что нужно знать об индексах в mongodb
          </a>
        </h3><p><a href="/database/mongodb/2014/03/07/mongodb-indexes.html"><img src="/assets/images/posts/2014-03-07-mongodb-indexes/mongoDB-logo_small.png" alt="Что нужно знать об индексах в mongodb" title="Что нужно знать об индексах в mongodb" /></a></p>

<p>Недавно закончил курс “M101P: MongoDB for Developers” (он периодически повторяется, например <a href="https://education.mongodb.com/courses/10gen/M101P/2014_April/about">следующий</a> стартует в апреле).
В процессе прохождения натолкнулся на некоторые интересные моменты.</p>

</li><li><span class="post-meta">Jan 30, 2014</span>
        <h3>
          <a class="post-link" href="/async/api/bitcoin/tornado/2014/01/30/async-bitcoin-rpc-client.html">
            Асинхронный Bitcoin RPC клиент на python
          </a>
        </h3><p><a class="github-button" href="https://github.com/st4lk/python-bitcoinrpc-tornado" data-icon="octicon-star" data-size="large" data-show-count="true" aria-label="Star st4lk/python-bitcoinrpc-tornado on GitHub">Star</a></p>

<p>Для работы с <a href="https://en.bitcoin.it/wiki/Original_Bitcoin_client/API_calls_list">Bitcoin RPC</a> на python’е есть библиотека <a href="https://github.com/jgarzik/python-bitcoinrpc">Python-BitcoinRPC</a>.</p>

<p>Но недавно мне понадобилось обратиться к API из приложения на tornado. Указанная библиотека работает в синхронном, т.е. блокирующем режиме. Для торнадо было бы намного лучше использовать асинхронную версию. Готовой найти не удалось, поэтому написал свой форк - асинхронный, который использует торнадовский AsyncHTTPClient: <a href="https://github.com/st4lk/python-bitcoinrpc-tornado">https://github.com/st4lk/python-bitcoinrpc-tornado</a>.</p>

</li><li><span class="post-meta">Dec 29, 2013</span>
        <h3>
          <a class="post-link" href="/async/tornado/mongodb/2013/12/29/tornado-web-application-example.html">
            Tornado: пример веб приложения
          </a>
        </h3><p><a class="github-button" href="https://github.com/st4lk/acl_webapp" data-icon="octicon-star" data-size="large" data-show-count="true" aria-label="Star st4lk/acl_webapp on GitHub">Star</a></p>

<p><a href="/async/tornado/mongodb/2013/12/29/tornado-web-application-example.html"><img src="/assets/images/posts/2013-12-29-tornado-web-application-example/tornado.jpeg" alt="Tornado: пример веб приложения" title="Tornado: пример веб приложения" /></a></p>

<p><a href="http://www.tornadoweb.org/">Tornado</a> - асинхронный веб фреймворк для python’а. Вначале я приведу краткий перечень плюсов и минусов tornado, а потом расскажу о типовом веб проекте с использованием этого инструмента.</p>

</li><li><span class="post-meta">Nov 13, 2013</span>
        <h3>
          <a class="post-link" href="/django/deploy/2013/11/13/django-project-beginning-working-server.html">
            Django проект: с нуля до работающего сервера
          </a>
        </h3><p>В этом посте хочу описать свой опыт создания и запуска django проекта на VPS-хостинге.</p>

<p>Разделим задачу на этапы:</p>

<ol>
  <li>Создание django-проекта</li>
  <li>Настройка деплоя</li>
  <li>Настройка сервера (установка нужных библиотек)</li>
  <li>Деплой проекта</li>
</ol>

</li><li><span class="post-meta">Sep 26, 2013</span>
        <h3>
          <a class="post-link" href="/django/logging/2013/09/26/django-logging-settings.html">
            Настройки логов для django
          </a>
        </h3><div class="gist-wrp"><div class="github-btn" id="github-btn" style="float:right;"> <a class="gh-btn" id="gh-btn" href="https://gist.github.com/st4lk/6725777" target="_blank"> <span class="gh-ico"></span> <span class="gh-text" id="gh-text">Gist</span> </a></div></div>

<p>Рассмотрим дефолтные настройки логов в django и попробуем их сделать максимально удобными.</p>

<p>Вот что есть в settings.py после команды <code class="language-plaintext highlighter-rouge">django-admin.py startproject project_name</code> (django 1.5):</p>

</li><li><span class="post-meta">Aug 20, 2013</span>
        <h3>
          <a class="post-link" href="/python/logging/2013/08/20/python-logging-every-day.html">
            Python logging на каждый день
          </a>
        </h3><div class="gist-wrp"><div class="github-btn" id="github-btn" style="float:right;"> <a class="gh-btn" id="gh-btn" href="https://gist.github.com/st4lk/6287746" target="_blank"> <span class="gh-ico"></span> <span class="gh-text" id="gh-text">Gist</span> </a></div></div>

<p>В процессе написания программы, скрипта, часто бывает нужно вывести какую-либо отладочную информацию или сообщить о каком-то событии. Известно, что для этих целей есть встроенный модуль <a href="http://docs.python.org/library/logging.html">logging</a>. Однако обычно у меня бывает так: времени в обрез, а все эти настройки логов (handlers, loggers, formatters и пр.) никак не могу запомнить, и на скорую руку вставляю просто print. Потом, если скрипт используется часто или его надо отдать заказчику - хочется чтобы все эти сообщения записывались в файл для последующего анализа. И приходится все переделывать с использованием logging. Так вот, чтобы не держать в голове все настройки логирования, пишу этот пост с необходимыми для работы параметрами.</p>

</li><li><span class="post-meta">Jul 11, 2013</span>
        <h3>
          <a class="post-link" href="/database/django/sql/2013/07/11/django-querysetcount-cache.html">
            Кеширование queryset.count в django
          </a>
        </h3><p><a href="/database/django/sql/2013/07/11/django-querysetcount-cache.html"><img src="/assets/images/posts/2013-07-11-django-querysetcount-cache/to-count-22117_small.jpeg" alt="Кеширование queryset.count в django" title="Кеширование queryset.count в django" /></a></p>

<p>Как-то обнаружил, что у меня идут несколько одинаковых запросов вида <code class="language-plaintext highlighter-rouge">SELECT COUNT(*) ...</code>. Оказалось (да, для меня это было новостью :) ), что метод <code class="language-plaintext highlighter-rouge">queryset.count()</code> в джанго кешируется по особому. Но лучше начать рассказ издалека.</p>

</li><li><span class="post-meta">Jun 20, 2013</span>
        <h3>
          <a class="post-link" href="/python/unicode/2013/06/20/unicode-string-formatting.html">
            Форматирование unicode строк
          </a>
        </h3><p>Вы знали, что если одно из значений строкового выражения с оператором <code class="language-plaintext highlighter-rouge">%</code> - unicode, то вся результирующая строка будет тоже unicode?</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="s">"Hello, %s"</span> <span class="o">%</span> <span class="sa">u</span><span class="s">"Alex"</span>
<span class="sa">u</span><span class="s">'Hello, Alex'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="s">"Hello, %s"</span> <span class="o">%</span> <span class="sa">u</span><span class="s">"Алексей"</span>
<span class="sa">u</span><span class="s">'Hello, </span><span class="se">\u0410\u043b\u0435\u043a\u0441\u0435\u0439</span><span class="s">'</span>
</code></pre></div></div>

</li><li><span class="post-meta">May 22, 2013</span>
        <h3>
          <a class="post-link" href="/django/python/unicode/2013/05/22/parse-url-which-chontains-unicode-query-using-urlp.html">
            Парсинг url&#39;а, содержащего unicode параметры, используя urlparse.parse_qs
          </a>
        </h3><p>Задача: получить словарь параметров URL’a. Например, имеем адрес:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://example.com/?key=value&amp;a=b
</code></pre></div></div>

<p>и нужно получить такой словарь:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="s">'key'</span><span class="p">:</span> <span class="p">[</span><span class="s">'value'</span><span class="p">],</span> <span class="s">'a'</span><span class="p">:</span> <span class="p">[</span><span class="s">'b'</span><span class="p">]}</span>
</code></pre></div></div>

<p>Тут значения являются списками, т.к. у одного ключа может быть несколько значений:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">In</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">example</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="err">?</span><span class="n">key</span><span class="o">=</span><span class="n">value</span><span class="o">&amp;</span><span class="n">a</span><span class="o">=</span><span class="n">b</span><span class="o">&amp;</span><span class="n">a</span><span class="o">=</span><span class="n">c</span>
<span class="n">Out</span><span class="p">:</span> <span class="p">{</span><span class="s">'key'</span><span class="p">:</span> <span class="p">[</span><span class="s">'value'</span><span class="p">],</span> <span class="s">'a'</span><span class="p">:</span> <span class="p">[</span><span class="s">'b'</span><span class="p">,</span> <span class="s">'c'</span><span class="p">]}</span>
</code></pre></div></div>

</li><li><span class="post-meta">Apr 12, 2013</span>
        <h3>
          <a class="post-link" href="/django/database/sql/2013/04/12/django-admin-site-optimisation.html">
            Оптимизация админки django
          </a>
        </h3><p><a href="/django/database/sql/2013/04/12/django-admin-site-optimisation.html"><img src="/assets/images/posts/2013-04-12-django-admin-site-optimisation/django-admin-performance.png" alt="Django admin site optimisation" title="Django admin site optimisation" /></a></p>

<p>Как известно, чем меньше запросов к базе данных делает сайт, тем лучше производительность. Обычно админка - часть сайта с меньшим трафиком, но все же хорошо, если от туда не идут лишние запросы. Это и приятней в пользовании, т.к. страница отдается быстрее, и все-таки разгружает сервер.</p>

<p>В этом посте я рассмотрю некоторые способы уменьшения количества запросов из админки к БД при использовании <code class="language-plaintext highlighter-rouge">__unicode__</code>, содержащего поля связанного объекта (ForeignKey). Думаю, глядя на примеры станет понятнее.</p>

</li><li><span class="post-meta">Mar 5, 2013</span>
        <h3>
          <a class="post-link" href="/python/2013/03/05/python-mutable-default-arguments.html">
            Функции с изменяемыми значениями по умолчанию в python&#39;e
          </a>
        </h3><p><a href="/python/2013/03/05/python-mutable-default-arguments.html"><img src="/assets/images/posts/2013-03-05-python-mutable-default-arguments/jellyfish-1.jpeg" alt="Python mutable default arguments" title="Python mutable default arguments" /></a></p>

<p>В python’е значения функции по умолчанию создаются в момент выполнения инструкции def, а не при каждом вызове функции. Если значение - неизменяемый объект (например строка, целое число, кортеж), то никаких подводных камней здесь нет. А вот если объект изменяемый (например список), то есть возможность попасть в ловушку. Вот пример:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="p">[]):</span>
    <span class="n">l</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">'x'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">l</span>
</code></pre></div></div>

<p>Казалось бы, при каждом вызове foo() будет возвращаться список [‘x’]. Но:</p>

</li><li><span class="post-meta">Feb 26, 2013</span>
        <h3>
          <a class="post-link" href="/django/i18n/2013/02/26/multilanguage-site-django-without-redirects.html">
            Многоязычный сайт на django без редиректов
          </a>
        </h3><p><a class="github-button" href="https://github.com/st4lk/django-solid-i18n-urls" data-color-scheme="no-preference: light; light: light; dark: dark;" data-size="large" data-show-count="true" aria-label="Star st4lk/django-solid-i18n-urls on GitHub">Star</a></p>

<p>Начиная с django 1.4, можно задать <a href="https://docs.djangoproject.com/en/dev/topics/i18n/translation/#language-prefix-in-url-patterns">префикс для url</a> для каждого включенного языка. К примеру, мы хотим сайт, который будет иметь русскую и английскую версию.</p>

<p>Для этого добавляем в <code class="language-plaintext highlighter-rouge">settings.py</code>:</p>

</li><li><span class="post-meta">Feb 4, 2013</span>
        <h3>
          <a class="post-link" href="/api/free/python/2013/02/04/script-downloading-music-vkcom-vkontakteru.html">
            Скрипт для скачивания музыки вконтакте
          </a>
        </h3><div class="gist-wrp"><div class="github-btn" id="github-btn" style="float:right;"> <a class="gh-btn" id="gh-btn" href="https://gist.github.com/st4lk/4708673" target="_blank"> <span class="gh-ico"></span> <span class="gh-text" id="gh-text">Gist</span> </a></div></div>

<p><a href="/api/free/python/2013/02/04/script-downloading-music-vkcom-vkontakteru.html"><img src="/assets/images/posts/2013-02-04-script-downloading-music-vkcom-vkontakteru/vk_audio.jpeg" alt="Скрипт для скачивания музыки вконтакте" title="Скрипт для скачивания музыки вконтакте" /></a></p>

<p>Беглый поиск соответствующего скрипта на python’е не дал результов. В <a href="http://habrahabr.ru/post/143860/">статье</a> на хабре ссылка не работает. Решил написать свой велосипед, он доступен <a href="https://gist.github.com/4708673">здесь</a>.</p>

<p>Запуск (нужен установленный <a href="http://www.python.org/download/releases/2.7.4/">python интерпретатор</a>):</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python vkcom_audio_download.py
</code></pre></div></div>

<p>Проверял на python 2.6 и 2.7. Никаких дополнительных библиотек не требуется.</p>

</li><li><span class="post-meta">Jan 3, 2013</span>
        <h3>
          <a class="post-link" href="/django/python/2013/01/03/sublime-text-and-github-gists.html">
            Sublime text и github gists
          </a>
        </h3><p><a href="/django/python/2013/01/03/sublime-text-and-github-gists.html"><img src="/assets/images/posts/2013-01-03-sublime-text-and-github-gists/logo_full.jpeg" alt="Sublime text и github gists" title="Sublime text и github gists" /></a></p>

<p>В <a href="http://www.sublimetext.com/">Sublime text</a> есть огромное количество полезных инструментов, помогающих быстро писать код. Пока я изучил лишь небольшую их часть, в том числе пытаюсь привыкнуть к Vintage mode (управление курсором в стиле vim). Но сейчас хочу рассказать о другом - об интеграции <a href="https://gist.github.com/">github gists</a> с sublime text. Если вы не знаете, github gists позволяет сохранять скрипты, снипеты в виде отдельного файла, чтобы не создавать для этого целый репозиторий. При этом поддерживаются многие функции репозитория - версии, возможность форка.</p>

</li><li><span class="post-meta">Nov 29, 2012</span>
        <h3>
          <a class="post-link" href="/django/python/2012/11/29/mobileesp-easily-detect-mobile-web-site-visitors.html">
            MobileESP: Скрипт определения мобильного устройства посетителя
          </a>
        </h3><p>Скрипт полезен, если вы хотите показывать разные версии сайта для обычных компьютеров и мобильных устройств. Большое количество методов для определения вида девайса. Доступен на разных языках программирования, включая python. Собственно порт на python был написан мной по просьбе freelance заказчика.</p>

</li><li><span class="post-meta">Nov 18, 2012</span>
        <h3>
          <a class="post-link" href="/django/python/sublime/2012/11/18/debug-django-project-embedded-python-debugger-pdb.html">
            Отладка django проекта с помощью встроенного python отладчика pdb
          </a>
        </h3><p>Я использую <a href="http://www.sublimetext.com/">sublime-text</a> в качестве редактора python кода. В нем нет встроенного отладчика, поэтому для отладки django проектов я в основном делал так:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span> <span class="n">var_name</span>
</code></pre></div></div>

<p>и в консоле локального сервера смотрел вывод команды. Я использую этот метод и сейчас, но иногда хочется пройтись по коду по шагам, посмотреть все переменные.</p>

<p>Это можно сделать с помощью встроенного python отладчика pdb:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pdb</span><span class="p">;</span> <span class="n">pdb</span><span class="p">.</span><span class="n">set_trace</span><span class="p">()</span>
</code></pre></div></div>

</li><li><span class="post-meta">Oct 8, 2012</span>
        <h3>
          <a class="post-link" href="/free/openshift/python/2012/10/08/cloud-service-openshift.html">
            Облачный сервис Openshift
          </a>
        </h3><p><a href="/free/openshift/python/2012/10/08/cloud-service-openshift.html"><img src="/assets/images/posts/2012-10-08-cloud-service-openshift/openshift-icon.png" alt="Облачный сервис Openshift" title="Облачный сервис Openshift" /></a></p>

<p>Я знаю немного хостингов с бесплатным тарифом и с поддержкой python. Это <a href="https://appengine.google.com/">Google App Engine</a> и <a href="https://www.alwaysdata.com/">Alwaysdata</a>. И вот недавно узнал про замечательный проект <a href="https://openshift.redhat.com/">Openshift</a> от RedHat, на котором и работает этот блог. Для начала небольшой обзор упомянутых хостингов.</p>

</li><li><span class="post-meta">Aug 31, 2012</span>
        <h3>
          <a class="post-link" href="/api/java/2012/08/31/aphorism-messenger.html">
            Мессенджер афоризмов
          </a>
        </h3><p><a href="/api/java/2012/08/31/aphorism-messenger.html"><img src="/assets/images/posts/2012-08-31-aphorism-messenger/owl_48x48.png" alt="Мессенджер афоризмов" title="Мессенджер афоризмов" /></a></p>

<p>У меня есть интересный проект, которым хотел бы поделиться. Идея создать его возникла во время изучения Java. Прочел я несколько книжек, сделал маленькие программки-задания и захотелось сделать нечто большее.</p>

</li></ul>

    <p class="rss-subscribe">subscribe <a href="/feed.xml">via RSS</a></p></div>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Developer articles</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Developer articles</li><li><a class="u-email" href="mailto:alexevseev@gmail.com">alexevseev@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/st4lk"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">st4lk</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
