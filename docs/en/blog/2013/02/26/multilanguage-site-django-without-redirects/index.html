<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Multilanguage site on django without redirects | Alexey Evseev</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="Multilanguage site on django without redirects" />
<meta name="author" content="Alexey Evseev" />
<meta property="og:locale" content="en" />
<meta name="description" content="Star Starting from django 1.4, it is possible to set url prefix for each activated language. For example, we want site, that will have russian and english version. To do it, add following to settings.py:" />
<meta property="og:description" content="Star Starting from django 1.4, it is possible to set url prefix for each activated language. For example, we want site, that will have russian and english version. To do it, add following to settings.py:" />
<link rel="canonical" href="https://st4lk.github.io/en/blog/2013/02/26/multilanguage-site-django-without-redirects/" />
<meta property="og:url" content="https://st4lk.github.io/en/blog/2013/02/26/multilanguage-site-django-without-redirects/" />
<meta property="og:site_name" content="Alexey Evseev" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2013-02-26T18:19:43+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Multilanguage site on django without redirects" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Alexey Evseev"},"dateModified":"2013-02-26T18:19:43+00:00","datePublished":"2013-02-26T18:19:43+00:00","description":"Star Starting from django 1.4, it is possible to set url prefix for each activated language. For example, we want site, that will have russian and english version. To do it, add following to settings.py:","headline":"Multilanguage site on django without redirects","mainEntityOfPage":{"@type":"WebPage","@id":"https://st4lk.github.io/en/blog/2013/02/26/multilanguage-site-django-without-redirects/"},"url":"https://st4lk.github.io/en/blog/2013/02/26/multilanguage-site-django-without-redirects/"}</script>
<!-- End Jekyll SEO tag -->
<link rel="shortcut icon" type="image/png" href="/favicon.png">
  <link rel="stylesheet" href="/en/assets/main.css">
  <link rel="stylesheet" href="/en/assets/css/styles.css"><link type="application/atom+xml" rel="alternate" href="https://st4lk.github.io/en/feed.xml" title="Alexey Evseev" /><!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8ZHLL9G1CF"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-8ZHLL9G1CF');
</script>
<link rel="alternate" hreflang="ru" href="https://st4lk.github.io/blog/2013/02/26/multilanguage-site-django-without-redirects/" />

  <link rel="alternate" hreflang="en" href="https://st4lk.github.io/en/blog/2013/02/26/multilanguage-site-django-without-redirects/" />

  <script async defer src="https://buttons.github.io/buttons.js"></script>
</head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/en/">Alexey Evseev</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          <a class="page-link" href="/en/blog/">Blog</a>
          <a class="page-link" href="/en/contact/">Contact</a>
          <a class="page-link" style="margin-right: 0px" href="/blog/2013/02/26/multilanguage-site-django-without-redirects/" ><img src="/en/assets/images/ru.png" /></a>
          <a class="page-link" href="/en/blog/2013/02/26/multilanguage-site-django-without-redirects/" ><img src="/en/assets/images/en.png" /></a>
          <a class="page-link" href="/en/search/" ><img src="/en/assets/images/search.svg" /></a>
        </div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Multilanguage site on django without redirects</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2013-02-26T18:19:43+00:00" itemprop="datePublished">Feb 26, 2013
      </time><span style="float:right">

  <span><a href="/en/category/django/">django</a></span>
&nbsp;

  <span><a href="/en/category/i18n/">i18n</a></span>


</span>
    </p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p><a class="github-button" href="https://github.com/st4lk/django-solid-i18n-urls" data-color-scheme="no-preference: light; light: light; dark: dark;" data-size="large" data-show-count="true" aria-label="Star st4lk/django-solid-i18n-urls on GitHub">Star</a></p>

<p>Starting from django 1.4, it is possible to set <a href="https://docs.djangoproject.com/en/dev/topics/i18n/translation/#language-prefix-in-url-patterns">url prefix</a> for each activated language. For example, we want site, that will have russian and english version.</p>

<p>To do it, add following to <code class="language-plaintext highlighter-rouge">settings.py</code>:</p>

<!--more-->

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># default language, it will be used, if django can't recognize user's language
</span><span class="n">LANGUAGE_CODE</span> <span class="o">=</span> <span class="s">'ru'</span>

<span class="c1"># list of activated languages
</span><span class="n">LANGUAGES</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="s">'ru'</span><span class="p">,</span> <span class="s">'Russian'</span><span class="p">),</span>
    <span class="p">(</span><span class="s">'en'</span><span class="p">,</span> <span class="s">'English'</span><span class="p">),</span>
<span class="p">)</span>

<span class="c1"># enable django’s translation system
</span><span class="n">USE_I18N</span> <span class="o">=</span> <span class="bp">True</span>

<span class="c1"># specify path for translation files
</span><span class="n">LOCALE_PATHS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">PROJECT_DIR</span><span class="p">,</span> <span class="s">'locale'</span><span class="p">),</span>
<span class="p">)</span>

<span class="c1"># add LocaleMiddleware
</span><span class="n">MIDDLEWARE_CLASSES</span> <span class="o">=</span> <span class="p">(</span>
   <span class="c1"># ...
</span>   <span class="s">'django.middleware.locale.LocaleMiddleware'</span><span class="p">,</span>
   <span class="c1"># ...
</span><span class="p">)</span>
</code></pre></div></div>

<p>And in <code class="language-plaintext highlighter-rouge">urls.py</code> use i18n_patterns instead of patterns:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">django.conf.urls.i18n</span> <span class="kn">import</span> <span class="n">i18n_patterns</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">i18n_patterns</span><span class="p">(</span><span class="s">''</span><span class="p">,</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s">'^about/$'</span><span class="p">,</span> <span class="s">'about.view'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'about'</span><span class="p">),</span>
<span class="p">)</span>
</code></pre></div></div>

<p>In this case on access to /about/, django will <a href="https://docs.djangoproject.com/en/dev/topics/i18n/translation/#how-django-discovers-language-preference">try to discover</a> language preference and make redirect to url with corresponding language prefix. Let’s say, that django has discovered russian language, then browser will be redirected to /ru/about/. But, if we’ll type url /en/about/, no redirects will occur and english version will be shown, because url already has prefix /en/.</p>

<p>But with such pattern can be problems with site indexing by some search engines. For example yandex.ru refused to index my site for a long time, because it doesn’t fetched http code 200 from site root. With google there were no such problems, but anyway, in help page it is not recommended to use redirects. From <a href="http://support.google.com/webmasters/bin/answer.py?hl=en&amp;answer=182192">http://support.google.com/webmasters/bin/answer.py?hl=en&amp;answer=182192</a>:</p>

<blockquote>
  <p>Avoid automatic redirection based on the user’s perceived language. These redirections could prevent users (and search engines) from viewing all the versions of your site.</p>
</blockquote>

<p><strong>So i decided to make tool, that will work without redirects</strong>.</p>

<p>The algorithm is following:</p>

<ol>
  <li>If url doesn’t have language prefix, then default language will be used (<code class="language-plaintext highlighter-rouge">settings.LANGUAGE_CODE</code>)</li>
  <li>If url has prefix, then language will be determined from this prefix (/en/ = english), but for default language there is no prefix.</li>
</ol>

<p>Luckily, it is needed a little peace of code for this, we need just to change LocaleMiddleware and i18n_patterns. I’ve made it in repo <a href="https://github.com/st4lk/django-solid-i18n-urls">https://github.com/st4lk/django-solid-i18n-urls</a>.</p>

<p>Installation:</p>

<ol>
  <li>
    <p>Setup django-solid-i18n-urls, for example using pip:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> pip <span class="nb">install </span>solid_i18n
</code></pre></div>    </div>
  </li>
  <li>
    <p>Change LocaleMiddleware to SolidLocaleMiddleware:</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="n">MIDDLEWARE_CLASSES</span> <span class="o">=</span> <span class="p">(</span>
    <span class="c1"># ...
</span>    <span class="c1"># remove 'django.middleware.locale.LocaleMiddleware',
</span>    <span class="s">'solid_i18n.middleware.SolidLocaleMiddleware'</span><span class="p">,</span> 
    <span class="c1"># ...
</span> <span class="p">)</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Use solid_i18n_patterns instead of i18n_patterns:</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">url</span>
 <span class="kn">from</span> <span class="nn">solid_i18n.urls</span> <span class="kn">import</span> <span class="n">solid_i18n_patterns</span>
  
 <span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">solid_i18n_patterns</span><span class="p">(</span><span class="s">''</span><span class="p">,</span>
     <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s">'^about/$'</span><span class="p">,</span> <span class="s">'about.view'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'about'</span><span class="p">),</span>
 <span class="p">)</span>
</code></pre></div>    </div>
  </li>
</ol>

<p>Repo on github: <a href="https://github.com/st4lk/django-solid-i18n-urls">https://github.com/st4lk/django-solid-i18n-urls</a>.</p>

<h3 id="updated">UPDATED</h3>

<p>Option <code class="language-plaintext highlighter-rouge">settings.SOLID_I18N_USE_REDIRECTS</code> is added (False by default). If it is True, then redirects will be used with following rules:</p>

<ol>
  <li>On request to url without language prefix, for example <code class="language-plaintext highlighter-rouge">'/'</code>, language will be determied from <a href="https://docs.djangoproject.com/en/dev/topics/i18n/translation/#how-django-discovers-language-preference">user preferences</a>. If that language is not equal to default (<code class="language-plaintext highlighter-rouge">settings.LANGUAGE_CODE</code>), then he will be redirected to corresponding url with prefix. But if it is equal, then url without prefix will be shown.</li>
  <li>On request to url with language prefix behaviour remains the same, i.e. language from prefix is used.</li>
</ol>

<p>Example:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># settings.py: 
</span><span class="n">LANGUAGE_CODE</span> <span class="o">=</span> <span class="s">'ru'</span>
<span class="n">SOLID_I18N_USE_REDIRECTS</span> <span class="o">=</span> <span class="bp">True</span>
</code></pre></div></div>
<p>Suppose preferred user language is english.</p>

<p>Then at request to <code class="language-plaintext highlighter-rouge">'/'</code> will be redirect to <code class="language-plaintext highlighter-rouge">'/en/'</code>.</p>

<p>And if preferred language is russian, then no redirect will occur, i.e. on request to ‘/’ exactly that url will be rendered.</p>

<h4 id="note">Note</h4>
<p>In such approach there is some nasty case. Imagine, that preferred browser language - english. But user wants to see russian version, that is rendered at url without prefix. If for switching language simple links are used like <code class="language-plaintext highlighter-rouge">&lt;a href="{{ specific language url}}"&gt;</code>, then user will be always redirected to english version (from <code class="language-plaintext highlighter-rouge">'/'</code> to <code class="language-plaintext highlighter-rouge">'/en/'</code>). To avoid this, it is needed to write information about choosen language to user cookies. It can be done using builtin django <a href="https://docs.djangoproject.com/en/dev/topics/i18n/translation/#the-set-language-redirect-view">set_language</a> view.</p>

  </div>

  <div class="post-categories">

  <span><a href="/en/category/django/">django</a></span>
&nbsp;

  <span><a href="/en/category/i18n/">i18n</a></span>


</div><div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      
      
      this.page.url = 'https://st4lk.github.io/en/blog/2013/02/26/multilanguage-site-django-without-redirects/';
      this.page.identifier = 'https://st4lk.github.io/blog/2013/02/26/multilanguage-site-django-without-redirects.html';
    };

    (function() {
      var d = document, s = d.createElement('script');

      s.src = 'https://lexev-dev.disqus.com/embed.js';

      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript><a class="u-url" href="/en/blog/2013/02/26/multilanguage-site-django-without-redirects/" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/en/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name"></li><li><a class="u-email" href="mailto:alexevseev@gmail.com">alexevseev@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"></div>

    </div>

  </div>

</footer>
<script id="dsq-count-scr" src="//lexev-dev.disqus.com/count.js" async></script></body>

</html>
